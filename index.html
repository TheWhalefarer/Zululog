<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ZuluLog</title>
  <link rel="apple-touch-icon" href="zululog-icon.png" />
  <link rel="icon" type="image/png" href="zululog-icon.png" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <style>
    :root {
      --bg: #0a0a0a;
      --panel: #1a1a1a;
      --text: #e0e0e0;
      --accent: #00b4ff;
      --button-bg: #121212;
      --button-border: #2a2a2a;
    }

    @media (prefers-color-scheme: light) {
      :root {
        --bg: #f7f7f7;
        --panel: #ffffff;
        --text: #111111;
        --accent: #007aff;
        --button-bg: #efefef;
        --button-border: #dddddd;
      }
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'SF Mono', 'Menlo', 'Courier', monospace;
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 30px 15px;
    }

    .app-header {
      text-align: center;
      margin-bottom: 1em;
    }

    .app-header img {
      width: 80px;
      height: auto;
      border-radius: 16px;
    }

    h1 {
      font-size: 1.6em;
      margin-top: 0.5em;
      letter-spacing: 1px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .panel {
      background-color: var(--panel);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 24px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }

    .entry {
      font-size: 1em;
      line-height: 1.6;
      margin: 0.5em 0;
      text-align: left;
    }

    .counter-display {
      font-size: 2.2em;
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
    }

    .button {
      width: 100%;
      font-size: 1.1em;
      padding: 16px;
      margin: 8px 0;
      background-color: var(--button-bg);
      color: var(--text);
      border: 1px solid var(--button-border);
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.15s ease;
    }

    .button:active {
      background-color: var(--accent);
      color: black;
    }

    .button:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }

    .label {
      font-weight: bold;
      color: var(--accent);
      text-transform: uppercase;
      font-size: 0.9em;
    }

    .device-iphone .button {
      font-size: 1.2em;
      padding: 18px;
    }

    .device-ipad .panel {
      max-width: 600px;
    }

    .device-desktop body {
      font-size: 1.1em;
    }
  </style>
</head>
<body>

  <div class="app-header">
    <img src="zululog-icon.png" alt="ZuluLog Icon">
    <h1>ZuluLog</h1>
  </div>

  <div id="app">
    <div class="panel">
      <div id="status" class="entry">Ready for Block Off</div>
      <div id="times" class="entry"></div>
      <div id="waypoints" class="entry" style="margin-top: 1em;"></div>
      <button class="button" onclick="recordTime()" id="timeButton">üïí Set Block Off</button>
      <button class="button" onclick="recordWaypoint()" id="waypointButton" style="display: none;">üìç Add Waypoint</button>
    </div>

    <div class="panel">
      <div class="label">Touch & Go</div>
      <div class="counter-display" id="touchgoCounter">0</div>
      <button class="button" onclick="incrementTouchGo()" id="touchgoButton">+1 Touch & Go</button>
      <button class="button" onclick="resetTouchGo()">Reset Counter</button>
    </div>

    <div class="panel" id="screenshotPanel" style="display:none;">
      <button class="button" onclick="captureScreenshot()">üì∏ Save Screenshot</button>
    </div>
  </div>

  <script>
    const states = ["Block Off", "Takeoff", "Landing", "Block On"];
    let currentStep = 0;
    let log = [];
    let waypoints = [];
    let touchGoCount = 0;
    let waypointCount = 0;

    const touchgoBtn = document.getElementById("touchgoButton");
    const timeBtn = document.getElementById("timeButton");
    const waypointBtn = document.getElementById("waypointButton");
    const screenshotPanel = document.getElementById("screenshotPanel");

    function formatLocalTime(date) {
      return date.toLocaleTimeString('en-GB', {
        hour: '2-digit', minute: '2-digit', hour12: false
      });
    }

    function formatUTCTime(date) {
      return date.getUTCHours().toString().padStart(2, '0') + ":" +
             date.getUTCMinutes().toString().padStart(2, '0');
    }

    function vibrateShort() {
      if (navigator.vibrate) {
        navigator.vibrate(30);
      }
    }

    function getStepButtonLabel(step) {
      const labels = [
        "üïí Set Block Off",
        "üõ´ Set Takeoff",
        "üõ¨ Set Landing",
        "üÖøÔ∏è Set Block On"
      ];
      return labels[step] || "üïí Record";
    }

    function recordTime() {
      vibrateShort();

      if (currentStep < states.length) {
        const now = new Date();
        const label = states[currentStep];
        log.push({
          label,
          local: formatLocalTime(now),
          utc: formatUTCTime(now)
        });
        currentStep++;
        updateDisplay();
        updateTouchGoState();
        updateWaypointButton();

        if (currentStep === states.length) {
          timeBtn.textContent = "üîÅ Reset";
          screenshotPanel.style.display = "block";
        }
      } else {
        const confirmReset = confirm("Reset all data?");
        if (confirmReset) {
          resetAll();
        }
      }
    }

    function recordWaypoint() {
      vibrateShort();
      waypointCount++;
      const now = new Date();
      waypoints.push({
        label: `Waypoint ${waypointCount}`,
        local: formatLocalTime(now),
        utc: formatUTCTime(now)
      });
      updateWaypointDisplay();
    }

    function updateWaypointDisplay() {
      const wpDiv = document.getElementById("waypoints");
      if (waypoints.length > 0) {
        wpDiv.innerHTML = waypoints.map(w =>
          `<div class="entry">
            <span class="label">${w.label}</span><br>
            Local: ${w.local} &nbsp; | &nbsp; UTC: ${w.utc}
          </div>`
        ).join("");
      } else {
        wpDiv.innerHTML = "";
      }
    }

    function updateDisplay() {
      const status = document.getElementById("status");
      const times = document.getElementById("times");

      times.innerHTML = log.map(e =>
        `<div class="entry">
          <span class="label">${e.label}</span><br>
          Local: ${e.local} &nbsp; | &nbsp; UTC: ${e.utc}
        </div>`
      ).join("");

      if (currentStep < states.length) {
        status.textContent = `Next: ${states[currentStep]}`;
        timeBtn.textContent = getStepButtonLabel(currentStep);
      } else {
        status.textContent = "Flight complete ‚úÖ";
        timeBtn.textContent = "üîÅ Reset";
      }
    }

    function incrementTouchGo() {
      vibrateShort();
      touchGoCount++;
      document.getElementById("touchgoCounter").textContent = touchGoCount;
    }

    function resetTouchGo() {
      vibrateShort();
      touchGoCount = 0;
      document.getElementById("touchgoCounter").textContent = touchGoCount;
    }

    function resetAll() {
      vibrateShort();
      currentStep = 0;
      log = [];
      waypoints = [];
      waypointCount = 0;
      resetTouchGo();
      updateDisplay();
      updateWaypointDisplay();
      updateTouchGoState();
      updateWaypointButton();
      timeBtn.textContent = getStepButtonLabel(currentStep);
      screenshotPanel.style.display = "none";
    }

    function updateTouchGoState() {
      touchgoBtn.disabled = (currentStep !== 2);
    }

    function updateWaypointButton() {
      waypointBtn.style.display = (currentStep === 2) ? "inline-block" : "none";
    }

    function captureScreenshot() {
      vibrateShort();
      html2canvas(document.querySelector("#app")).then(canvas => {
        const link = document.createElement('a');
        link.download = 'zululog-screenshot.png';
        link.href = canvas.toDataURL("image/png");
        link.click();
      });
    }

    function detectDevice() {
      const ua = navigator.userAgent.toLowerCase();
      if (/iphone/.test(ua)) {
        document.body.classList.add("device-iphone");
      } else if (/ipad/.test(ua)) {
        document.body.classList.add("device-ipad");
      } else {
        document.body.classList.add("device-desktop");
      }
    }

    updateTouchGoState();
    updateWaypointButton();
    detectDevice();
  </script>

</body>
</html>
